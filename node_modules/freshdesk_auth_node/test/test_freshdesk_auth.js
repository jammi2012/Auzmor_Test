'use strict';

var expect = require('chai').expect;

var jwt = require('jsonwebtoken');

var FreshdeskAuth = require('../freshdesk_auth.js');

const KEY = '18a9cc87b8aaab31a31262e93841174765439bdef0f9857b';
const source = 'http://localhost:3000/product/1/extensions/1.json';

describe('test digest()', function(){
  it('success', function(done){
    const expected = 'Freshdesk b1a2671a8ab2986e4bddd001e614a2c2';
    let fa = new FreshdeskAuth['fdAuth'](KEY);
    console.log(fa.digest(source));
    expect(fa.digest(source)).to.equal(expected);
    done();
  });
});

describe('test isValid()', function(){
  it('success', function(done){
    let fa = new FreshdeskAuth['fdAuth'](KEY);
    let hash = 'Freshdesk b1a2671a8ab2986e4bddd001e614a2c2';
    expect(fa.isValid(source, hash)).to.be.ok;
    done();
  });
});

describe('Test generateJwtToken() and verify()', function(){
  it('success', function(done) {
    let secret = 'secret123'
    let obj = new FreshdeskAuth['jwtAuth']({secret: secret, exp: 10, iss: 'test'});
    let testData = {"foo" : "test"};
    obj.generateJwtToken(testData, null, function(err, token){
        obj.verify(token, function(err, data) {
          expect(data['foo']).to.equal(testData['foo']);
          done();
        });
    });
  });
});
